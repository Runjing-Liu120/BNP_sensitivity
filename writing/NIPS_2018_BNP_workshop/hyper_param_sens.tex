
\paragraph{General hyperparamter sensitivity.}
We with to approximate the sensitity of $g(\etaopt)$ to perturbations of the
value of $\alpha$ and to the functional form of $p_{0k}$.  To do this, we will
call on a general result for the sensitivity of VB optima to vectors of
real-valued hyperparameters.  Suppose the exact posterior is parameterized by a
real-valued hyperparameter $\epsilon$, i.e., the posterior is given by
$p\left(\theta, z \vert y, \epsilon\right)$. In the present work, $\epsilon$
will parameterize perturbations to the prior, as we will describe in more detail
shortly.  Then the optimal variational approximation is also a function of
$\epsilon$ through \prettyref{eq:kl_objective}:
%
\begin{align}
    \etaopt\left(\epsilon\right) &=
    \argmin_{\eta} KL\left(
        q(\theta, z \vert \eta) \big\| p(\theta, z | y, \epsilon) \right) =:
    \argmin_{\eta} KL\left(\eta, \epsilon\right) \label{eq:pert_kl_objective}
\end{align}
%
In general, the dependence of $\etaopt\left(\epsilon\right)$ on $\epsilon$ is
complex and non-linear, but we may approximate it with a first-order Taylor
series. Without loss of generality, let $\epsilon=0$ represent the unperturbed
posterior, so that $p\left(\theta, z \vert y, \epsilon=0\right) = p\left(\theta,
z \vert y \right)$.  Then
%
\begin{align}
\etaopt(\epsilon) &\approx
 \etaopt(0) +
    \frac{d \etaopt(\epsilon)}{d\epsilon^T}\Big|_{\epsilon=0}
    \epsilon \label{eq:our_approximation}
\end{align}
%
Under mild regularity conditions that are satisfied in the present case,
\citet[Theorem 2]{giordano:2017:covariances} gives a closed form
expression for $d \etaopt(\epsilon)/ d\epsilon^T \vert_{\epsilon = 0}$
which can be easily evaluated using automatic differentiation
\citep{maclaurin:2015:autograd} (see \prettyref{app:sensitivity}).

% If $g(\eta)$ is the variational quantity of interest, e.g. the expected number
% of posterior quantities in \prettyref{eq:expected_num_clusters}, then we
% approximate
%
% \begin{align}
%     g(\eta^*(\alpha_1)) \approx g(\eta^*_{lin}(\alpha_1))
% \end{align}

\subsection{Functional perturbations}
\label{sec:func_pert}
%
We also consider changing the functional form of the prior on the sticks.
Consider some function $\phi(\nu_k)$, where $\phi(\nu_k) > 0$ for all $\nu_k \in
[0, 1]$. Then we define our contaminated prior on stick $k$ as

\begin{align}
	\label{eq:expon_perturb}
	p^c_{k}(\nu_k ; \epsilon, \phi) :=
  \frac{p_{0k}(\nu_k)\phi(\nu_k)^\epsilon}{\int p_0(\nu_k')\phi(\nu_k')^\epsilon \lambda(d\nu_k')}
\end{align}
%
For example, we might consider a different prior for the sticks, say
$p_1(\nu_k)$; letting $\phi(\nu_k) = p_1(\nu_k) / p_{0k}(\nu_k)$, we are
swapping the original prior for a a new prior $p_1$ as $\epsilon \rightarrow 1$.

Here,
%
\begin{align}
  \frac{\partial}{\partial \epsilon} \log p_k^k(\nu_k | \epsilon, \phi) := \log \phi(\nu_k) -
    \frac{\int p_0(\nu_k')\log\phi(\nu_k')e^{\epsilon\phi(\nu_k')} \lambda(d\nu_k')}{\int p_0(\nu_k')\phi(\nu_k')^\epsilon \lambda(d\nu_k')}
\end{align}
%
The second term does not depend on $\nu_k$, so $f_\eta =
\frac{\partial}{\partial \eta} E_{q_\eta}[\log \phi(\nu_k)]$.

Now if we perturb each stick $k$ by the same perturbation $\phi(\cdot)$, then
the derivative of $\eta^*$ with respect to this perturbation is given by
%
\begin{align}
   \frac{d}{d\epsilon}\eta^*(\epsilon) &=
   H^{-1}\frac{\partial}{\partial \eta} E_{q_\eta}\Big[\sum_{k = 1}^K \log \phi(\nu_k)\Big]
  \label{eq:sensitivity_exp_pert}
\end{align}
%
so derivative for pertubing all the sticks is given by the sum of the deriatives
of perturbing each stick individually
\citep{gustafson:2012:localrobustnessbook}.
